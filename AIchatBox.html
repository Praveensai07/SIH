<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OpenAI Chat Prototype</title>
   <link rel="stylesheet" href="chat.css">
</head>
<body>
  <div class="Heading">Chat with Prakruthi</div>  <div id="translate"></div>
  <span><input type="checkbox"  id="theme"></span>
  <div class="chat-box"></div>
  <div class="search">
      <input type = "text" id="msg" placeholder="Enter a Message..."  spellcheck="false" > 
      <button><img src="images/search.png" alt="search"  onclick="sendMessage()" ></button>
     
  </div>
  <script>
  // API key removed for security. All requests are now proxied through the backend.
    const voiceMsg = "Not working.";
    const msgInput = document.getElementById("msg");
    const chatBox = document.querySelector(".chat-box");
    async function sendMessage() {
      
      

      // show user message
      
      const userMsg = document.createElement("p");
      userMsg.textContent =" You : "+ msgInput.value;
      userMsg.className = "user";
      chatBox.appendChild(userMsg).style.textAlign="right";

      // call backend proxy for OpenAI API
      const res = await fetch("http://localhost:3001/ai", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          model: "gpt-4o-mini",
          messages: [{ role: "user", content: msgInput.value }]
        })
      });

      const data = await res.json();

      // show AI reply or error
      if (data.error) {
        const aiMsg = document.createElement("p");
        aiMsg.textContent = "Error: " + (data.error.message || data.error);
        aiMsg.className = "ai";
        chatBox.appendChild(aiMsg);
      } else if (data.choices && data.choices[0] && data.choices[0].message) {
        const aiMsg = document.createElement("p");
        aiMsg.textContent = "Prakruthi : " + data.choices[0].message.content;
        aiMsg.className = "ai";
        chatBox.appendChild(aiMsg);
      } else {
        const aiMsg = document.createElement("p");
        aiMsg.textContent = "No response from AI.";
        aiMsg.className = "ai";
        chatBox.appendChild(aiMsg);
      }
      msgInput.value = "";
      chatBox.scrollTop = chatBox.scrollHeight;
      // voiceMsg = data.choices[0].message.content;
      // console.log(voiceMsg); 
    }
    const bttn = document.getElementById('.btnToSt');
    // const text = document.getElementById('voiceMsg');
        bttn.addEventListener('click',()=>{
          const speech = new SpeechSynthesisUtterance();
          speech.text = voiceMsg;
          speech.volume = 1;
          speech.rate = 1;
          speech.pitch = 100;
          window.speechSynthesis.speak(speech);
        });

        
      
  </script>
  <script src="sih.js" type="text/javascript">
        function googleTranslateElementInit() {
        new google.translate.TranslateElement(
          { pageLanguage: 'en' },
          'translate'
        );
      }
    </script>
    <script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit">
    </script>
</body>
</html>
